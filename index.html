
<html>
<head>
<meta charset="UTF-8">
<style>
ul{
  list-style:none
}
div.Content>ul>li{
  padding-bottom:.5em
}
</style>
<script>
  var VEX={page:{
    constant:{
      startAt:1544828400,interval:68400/*19*60*60*/,
      towInvasionBefore:5
    },
    func:{
      jsDate2DateObj:function(d){return {y:d.getFullYear(),m:d.getMonth()+1,d:d.getDate()}},
      dateObj2JSDate:function(dateObj){return new Date(dateObj.y+"-"+dateObj.m+"-"+dateObj.d+" 00:00:00");},
      dateObj2Ux:function(dateObj){return new Date(dateObj.y+"-"+dateObj.m+"-"+dateObj.d+" 00:00:00").getTime()/1000;},
      getAreaByIndex:(function(){
        var areas=["德鲁斯瓦","祖达萨","提拉加德海峡","纳兹米尔","斯托颂","沃顿"];
        return function(index){
          return areas[index%6];
        };
      })()
    },
    today:new Date()
  }};
</script>
</head>
<body>

<div class="TopTitle">
  <h1>库尔提拉斯日报</h1>
</div>

<div class="Content" style="margin:1em">
  <h2 style="background:#dbdada;padding:.5em">突袭时刻表</h3>
  <ul>
  </ul>
</div>

<script>
  (function(){
    var PAGE=VEX.page,funcs=PAGE.func,today=PAGE.today;
    var startAt=PAGE.constant.startAt,interval=PAGE.constant.interval,towInvasionBefore=PAGE.constant.towInvasionBefore;
    var todayObj=funcs.jsDate2DateObj(today),todayUx=funcs.dateObj2Ux(todayObj);
    var scheduleUl=document.querySelector("div.Content>ul");

    var toMHour=function(h){return h>24?h%24:h;}
    var genTodayInvasionParam=function(){
      var index=parseInt((todayUx-startAt)/interval);
      var invasion1=(interval-(todayUx-startAt)%interval)/3600;
      var durations=[[invasion1,invasion1+7]];

      if(durations[0][1]>24){
        durations[0][1]-=24;
        return durations;
      }

      if(invasion1<=towInvasionBefore){//tow invasion in one day
        durations.push([invasion1+19,invasion1+26]);
        if(durations[1][1]>24)durations[1][1]-=24;
      }
      
      return {durations:durations,index:index};
    }

    var genfutureInvasionParam=function(todayInvasion,dayNum){
      var ret=[];

      for(var i=0;i<dayNum;++i){
        var next={durations:[],index:todayInvasion.index+i+1};
        var prev=null;
        if(ret.length==0){
          prev=todayInvasion.durations[todayInvasion.durations.length-1][0];
        }else{
          var pDurations=ret[ret.length-1].durations;
          prev=pDurations[pDurations.length-1][0];
        }

        var start=toMHour(prev+19);
        next.durations.push([start,toMHour(start+7)]);
        if(start<=towInvasionBefore){
          next.durations.push([start+19,toMHour(start+26)]);
        }
        ret.push(next);
      }
      
      return ret;
    }

    var renderInvasionPlan=function(invasionParam,to){
      var duration=invasionParam.durations;
      var index=invasionParam.index;
      var area=func.getAreaByIndex(index);

      var wrapLi=document.createElement("li");
      var wrapDiv=document.createElement("div");
      var dateH3=document.createElement("h3");
      var invasionUl=document.createElement("ul");
      var dateTxt=document.createTextNode(dateObj.y+"-"+dateObj.m+"-"+dateObj.d);
      dateH3.appendChild(dateTxt);

      for(var i=0; i<durations.length; i++){
        var invasionLi=document.createElement("li");
        var invasionTxt=document.createTextNode(
          durations[i][0]+":00 - "+durations[i][1]+":00 在 "+area+" 上演第 "+(index+1)+" 入侵"
        );
        
        invasionLi.appendChild(invasionTxt);
        invasionUl.appendChild(invasionLi);
      }

      wrapDiv.appendChild(dateH3);
      wrapDiv.appendChild(invasionUl);
      wrapLi.appendChild(wrapDiv);
      to.appendChild(wrapLi);
    };
    
    var todayInvasion=genTodayInvasionParam();
    renderInvasionPlan(todayInvasion);
    //next few days
    var futureDaysInvasion=genfutureInvasionParam(todayInvasion,6);
    for(var j=0;j<7;j++){
      renderInvasionPlan(futureDaysInvasion[j]);
    }
  })();
</script>
</body>
</html>